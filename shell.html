<!doctype html>
<html lang="en-us">

<head>
	<meta charset="utf-8">
	<meta name="viewport"
		content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
	<title>Zigbeat</title>
	<style>
		html,
		body {
			margin: 0;
			height: 100%;
			width: 100%;
			background-color: black;
			overflow: hidden;
		}

		canvas {
			position: fixed;
			inset: 0;
			border: 0;
			margin: 0;
			width: 100vw;
			height: 100vh;
			overflow: hidden;
			display: block;
			image-rendering: optimizeSpeed;
			image-rendering: -moz-crisp-edges;
			image-rendering: -o-crisp-edges;
			image-rendering: -webkit-optimize-contrast;
			image-rendering: optimize-contrast;
			image-rendering: crisp-edges;
			image-rendering: pixelated;
			-ms-interpolation-mode: nearest-neighbor;
		}

		#start-overlay {
			position: fixed;
			inset: 0;
			background: rgba(0, 0, 0, 0.95);
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			color: #00ff00;
			font-family: monospace;
			font-size: 24px;
			cursor: pointer;
			z-index: 1000;
			transition: opacity 0.3s ease;
		}

		#start-overlay.hidden {
			opacity: 0;
			pointer-events: none;
		}

		#start-overlay p {
			margin: 10px 0;
			text-align: center;
		}

		#start-overlay .subtitle {
			font-size: 16px;
			color: #888;
		}
	</style>
</head>

<body>
	<div id="start-overlay">
		<p>Play</p>
	</div>
	<canvas  id="canvas" oncontextmenu="event.preventDefault()"></canvas>
	<script type='text/javascript'>
		var Module = {
			preRun: [],
			postRun: [],
			print: (function () {
				return function (text) {
					text = Array.prototype.slice.call(arguments).join(' ');
					console.log(text);
				};
			})(),
			printErr: function (text) {
				text = Array.prototype.slice.call(arguments).join(' ');
				console.error(text);
			},
			canvas: (function () {
				var canvas = document.getElementById('canvas');
				return canvas;
			})(),
			setStatus: function (text) { },
			monitorRunDependencies: function (left) { },
		};
		window.onerror = function () {
			console.log("onerror: " + event.message);
		};
	</script>
	<script>
		window.va = window.va || function () {(window.vaq = window.vaq || []).push(arguments);};
	</script>
	<script>
		// Resume AudioContext on first user interaction
		var audioStarted = false;

		function resumeAudio() {
			if (audioStarted) return;
			audioStarted = true;

			console.log('User interaction detected, resuming audio...');

			// Hide overlay with fade effect
			var overlay = document.getElementById('start-overlay');
			overlay.classList.add('hidden');

			// Remove overlay from DOM after transition
			setTimeout(function() {
				if (overlay.parentNode) {
					overlay.parentNode.removeChild(overlay);
				}
			}, 300);

			// Resume any suspended AudioContexts (used by Emscripten/miniaudio)
			if (window.miniaudio && window.miniaudio.devices) {
				window.miniaudio.devices.forEach(function(device) {
					if (device.webaudio && device.webaudio.state === 'suspended') {
						device.webaudio.resume().then(function() {
							console.log('AudioContext resumed successfully');
						}).catch(function(err) {
							console.error('Failed to resume AudioContext:', err);
						});
					}
				});
			}
		}

		// Listen for any user interaction (once)
		document.addEventListener('click', resumeAudio, { once: true });
		document.addEventListener('keydown', resumeAudio, { once: true });
		document.addEventListener('touchstart', resumeAudio, { once: true });

		// Also add to Module.postRun to ensure it works after WASM loads
		Module.postRun.push(function() {
			console.log('Module loaded, waiting for user interaction to start audio');
		});
	</script>
	{{{ SCRIPT }}}
</body>

</html>
